<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="CSM DRIVE ULTRA PRO — Secure Cloud File Manager">
    <meta name="theme-color" content="#00ffcc">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CSM DRIVE">
    <link rel="manifest" href="manifest.json">
    <title>CSM DRIVE | ULTRA PRO</title>

    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500;600&family=Orbitron:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- App CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ── Offline banner ─────────────────────────────────────────── -->
<div id="offlineBanner" class="offline-banner hidden">
    <i class="fas fa-wifi-slash"></i>
    <span>OFFLINE MODE — Showing cached data. Changes will sync when reconnected.</span>
    <button onclick="document.getElementById('offlineBanner').classList.add('hidden')">×</button>
</div>

<!-- ── Particle canvas ───────────────────────────────────────── -->
<canvas id="particles" class="particles"></canvas>

<!-- ─────────────────────────── LOGIN ────────────────────────── -->
<div id="loginSection" class="login-section">
    <div class="login-bg-grid"></div>
    <div class="login-card" data-aos>
        <div class="login-logo">
            <div class="logo-hex">
                <i class="fas fa-database"></i>
            </div>
            <div class="logo-text">
                <span class="logo-main">CSM DRIVE</span>
                <span class="logo-sub">ULTRA PRO</span>
            </div>
        </div>
        <div class="login-dev-tag">by Csm Mohasin Alam</div>
        <div class="login-fields">
            <div class="field-wrap">
                <i class="fas fa-at field-icon"></i>
                <input type="email" id="loginEmail" placeholder="ACCESS EMAIL" autocomplete="email">
            </div>
            <div class="field-wrap">
                <i class="fas fa-shield-halved field-icon"></i>
                <input type="password" id="loginPass" placeholder="SECURE KEY" autocomplete="current-password">
            </div>
        </div>
        <button id="doLogin" class="login-btn">
            <span class="btn-idle"><i class="fas fa-fingerprint"></i>&nbsp; AUTHENTICATE</span>
            <span class="btn-loading hidden"><i class="fas fa-spinner fa-spin"></i>&nbsp; PROCESSING…</span>
        </button>
        <div class="login-footer">
            <span class="lf-item"><i class="fas fa-lock"></i> AES Encrypted</span>
            <span class="lf-item"><i class="fas fa-wifi"></i> Offline Ready</span>
            <span class="lf-item"><i class="fas fa-cloud"></i> Cloud Sync</span>
        </div>
    </div>
</div>

<!-- ─────────────────────── PASSCODE ─────────────────────────── -->
<div id="passcodeSection" class="passcode-section hidden">
    <div class="pc-card" data-aos>
        <div class="pc-icon"><i class="fas fa-shield-halved"></i></div>
        <div class="pc-title">ACCESS CODE</div>
        <div id="passcodeMessage" class="pc-msg">Enter your 4-digit access code</div>
        <div id="passcodeDots" class="pc-dots">
            <div class="passcode-dot"></div>
            <div class="passcode-dot"></div>
            <div class="passcode-dot"></div>
            <div class="passcode-dot"></div>
        </div>
        <div class="pc-pad">
            <button class="pc-key" onclick="window.enterPasscode('1')">1</button>
            <button class="pc-key" onclick="window.enterPasscode('2')">2</button>
            <button class="pc-key" onclick="window.enterPasscode('3')">3</button>
            <button class="pc-key" onclick="window.enterPasscode('4')">4</button>
            <button class="pc-key" onclick="window.enterPasscode('5')">5</button>
            <button class="pc-key" onclick="window.enterPasscode('6')">6</button>
            <button class="pc-key" onclick="window.enterPasscode('7')">7</button>
            <button class="pc-key" onclick="window.enterPasscode('8')">8</button>
            <button class="pc-key" onclick="window.enterPasscode('9')">9</button>
            <button class="pc-key pc-cancel" onclick="window.cancelPasscode()">✕</button>
            <button class="pc-key" onclick="window.enterPasscode('0')">0</button>
            <button class="pc-key pc-del" onclick="window.clearPasscode()">⌫</button>
        </div>
    </div>
</div>

<!-- ─────────────────────── MAIN APP ─────────────────────────── -->
<div id="mainContent" class="main-content hidden">

    <!-- Header -->
    <header class="app-header" id="appHeader" data-aos>
        <div class="hdr-left">
            <div class="hdr-logo">
                <div class="hdr-hex"><i class="fas fa-database"></i></div>
                <div class="hdr-title-wrap">
                    <span class="hdr-title">CSM DRIVE</span>
                    <span class="hdr-ver">ULTRA PRO</span>
                </div>
            </div>
        </div>
        <div class="hdr-right">
            <div id="syncStatusBadge" class="sync-badge" title="Sync Status">
                <i class="fas fa-check-circle"></i> <span>SYNCED</span>
            </div>
            <button class="hdr-btn" id="themeToggleBtn" onclick="window.toggleTheme()" title="Theme">
                <i class="fas fa-circle-half-stroke"></i>
            </button>
            <button class="hdr-btn" onclick="window.confirmLogout()" title="Sign out">
                <i class="fas fa-right-from-bracket"></i>
            </button>
        </div>
    </header>

    <!-- Stats bar -->
    <section class="stats-bar" data-aos data-aos-delay="80">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-image"></i></div>
            <div class="stat-info"><span id="imgCount">0</span><span class="stat-label">Images</span></div>
            <div class="stat-bar-wrap"><div class="stat-bar neon-bar" id="imgBar"></div></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="color:var(--neon2)"><i class="fas fa-video"></i></div>
            <div class="stat-info"><span id="vidCount">0</span><span class="stat-label">Videos</span></div>
            <div class="stat-bar-wrap"><div class="stat-bar neon2-bar" id="vidBar"></div></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="color:#ffd700"><i class="fas fa-star"></i></div>
            <div class="stat-info"><span id="starCount">0</span><span class="stat-label">Starred</span></div>
            <div class="stat-bar-wrap"><div class="stat-bar gold-bar" id="starBar"></div></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="color:var(--danger)"><i class="fas fa-trash"></i></div>
            <div class="stat-info"><span id="trashCount">0</span><span class="stat-label">Trashed</span></div>
            <div class="stat-bar-wrap"><div class="stat-bar danger-bar" id="trashBar"></div></div>
        </div>
        <div class="stat-card storage-card">
            <div class="stat-icon"><i class="fas fa-hard-drive"></i></div>
            <div class="stat-info stat-storage">
                <span id="storageText">0 MB / 1024 MB</span>
                <div class="storage-bar-wrap"><div id="storageFill" class="storage-fill"></div></div>
            </div>
        </div>
    </section>

    <!-- Folder bar -->
    <section class="folder-section" data-aos data-aos-delay="120">
        <div class="folder-bar" id="folderBar"></div>
    </section>

    <!-- Toolbar -->
    <section class="toolbar" data-aos data-aos-delay="160">
        <div class="toolbar-left">
            <div class="search-wrap">
                <i class="fas fa-magnifying-glass"></i>
                <input type="text" id="searchInput" placeholder="Search files…" oninput="window.handleSearch()">
                <button class="search-clear" id="searchClearBtn" onclick="window.clearSearch()" title="Clear">×</button>
            </div>
            <select id="sortSelect" class="sort-select" onchange="window.handleSort()">
                <option value="newest">↓ Newest</option>
                <option value="oldest">↑ Oldest</option>
                <option value="az">A → Z</option>
                <option value="za">Z → A</option>
                <option value="largest">Largest</option>
                <option value="smallest">Smallest</option>
            </select>
        </div>
        <div class="toolbar-right">
            <button id="gridViewBtn" class="view-btn active" onclick="window.setView('grid')" title="Grid"><i class="fas fa-grip"></i></button>
            <button id="listViewBtn" class="view-btn" onclick="window.setView('list')" title="List"><i class="fas fa-list"></i></button>
            <button class="upload-btn" onclick="window.toggleUploadPanel()" title="Upload">
                <i class="fas fa-cloud-arrow-up"></i>
                <span>Upload</span>
                <span id="uploadQueueBadge" class="queue-badge hidden">0</span>
            </button>
            <button class="select-btn" id="selectModeBtn" onclick="window.toggleSelectMode()" title="Select">
                <i class="fas fa-check-square"></i>
            </button>
        </div>
    </section>

    <!-- Tabs -->
    <nav class="tabs" data-aos data-aos-delay="200">
        <button class="tab-btn active" onclick="window.setTab('all', this)"><i class="fas fa-layer-group"></i> All</button>
        <button class="tab-btn" onclick="window.setTab('image', this)"><i class="fas fa-image"></i> Images</button>
        <button class="tab-btn" onclick="window.setTab('video', this)"><i class="fas fa-video"></i> Videos</button>
        <button class="tab-btn" onclick="window.setTab('starred', this)"><i class="fas fa-star"></i> Starred</button>
        <button class="tab-btn" onclick="window.setTab('locked', this)"><i class="fas fa-lock"></i> Locked</button>
        <button class="tab-btn" onclick="window.setTab('trash', this)"><i class="fas fa-trash"></i> Trash</button>
    </nav>

    <!-- Trash actions -->
    <div id="trashActions" class="trash-actions hidden">
        <button class="trash-btn-restore" onclick="window.restoreAll()"><i class="fas fa-rotate-left"></i> Restore All</button>
        <button class="trash-btn-purge" onclick="window.purgeTrash()"><i class="fas fa-fire"></i> Empty Trash</button>
    </div>

    <!-- Multi select bar -->
    <div id="multiBar" class="multi-bar hidden">
        <div class="multi-count"><span id="selectedCount">0</span> selected</div>
        <div id="multiBarActions" class="multi-actions"></div>
        <button class="multi-close" onclick="window.toggleSelectMode()"><i class="fas fa-xmark"></i></button>
    </div>

    <!-- Upload panel -->
    <div id="uploadPanel" class="upload-panel hidden">
        <div class="up-inner">
            <div id="dropZone" class="drop-zone" ondrop="window.handleDrop(event)" ondragover="event.preventDefault()" ondragenter="this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')">
                <div class="dz-icon"><i class="fas fa-cloud-arrow-up"></i></div>
                <div class="dz-text">Drop files here or</div>
                <label class="dz-btn">
                    <i class="fas fa-folder-open"></i> Browse Files
                    <input type="file" id="fileInput" multiple accept="image/*,video/*" onchange="window.handleFileSelect(event)">
                </label>
                <div class="dz-hint">Images & Videos · Max 50MB each</div>
            </div>
            <div id="stagedFiles" class="staged-files"></div>
            <div class="up-meta">
                <input type="text" id="uploadName" placeholder="Custom name (optional)">
                <select id="uploadFolder"><option value="">No Folder</option></select>
            </div>
            <div id="uploadProgress" class="upload-progress hidden">
                <div class="up-progress-label">
                    <span id="upFileName">Uploading…</span>
                    <span id="upPercent">0%</span>
                </div>
                <div class="up-bar-wrap"><div id="upBar" class="up-bar"></div></div>
            </div>
            <div class="up-actions">
                <button class="up-cancel" onclick="window.toggleUploadPanel()">Cancel</button>
                <button class="up-submit" id="uploadBtn" onclick="window.startUpload()">
                    <i class="fas fa-rocket"></i> Upload
                </button>
            </div>
        </div>
    </div>

    <!-- File grid -->
    <main id="fileGrid" class="grid"></main>

    <!-- Context menu -->
    <div id="contextMenu" class="context-menu hidden"></div>

    <!-- Modal overlay -->
    <div id="modalOverlay" class="modal-overlay hidden">
        <div class="modal-box" id="modalBox"></div>
    </div>

    <!-- App footer / developer credit -->
    <footer class="app-footer" data-aos>
        <div class="footer-inner">
            <div class="footer-logo">
                <i class="fas fa-database"></i> CSM DRIVE ULTRA PRO
            </div>
            <div class="footer-dev">
                Crafted by <span class="footer-dev-name">Csm Mohasin Alam</span>
            </div>
            <div class="footer-links">
                <span class="footer-link"><i class="fas fa-shield-halved"></i> Secure</span>
                <span class="footer-link"><i class="fas fa-wifi"></i> Offline-Ready</span>
                <span class="footer-link"><i class="fas fa-cloud"></i> Firebase</span>
                <span class="footer-link"><i class="fas fa-image"></i> Cloudinary</span>
            </div>
        </div>
    </footer>

</div><!-- /mainContent -->

<!-- NexusLightbox (zero CDN deps) -->
<script src="lightbox.js"></script>

<!-- App script (ES module for Firebase) -->
<script type="module" src="script.js"></script>

<!-- SW Registration -->
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(r => console.log('[SW] Registered', r.scope))
            .catch(e => console.warn('[SW] Failed', e));
    });
}
</script>

</body>
</html>
